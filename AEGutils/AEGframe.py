#-*- coding:utf-8 -*-
from AEGcommon import printf
from idc import *
from AEGconfig import *
def get_stack_arg_offset( addr, arg , base = None):
	'''
	Refernce : https://gist.github.com/syndrowm/2968620
	'''
	stack = GetFrame(addr)
	size = GetStrucSize(stack)
	
	names = []
	for i in range(size):
		n = GetMemberName(stack , i) 
		if n and not n in names :
			names.append(n)
	#printf(arg , verbose=LOG_LEVEL_DEBUG)

	printf('names: %s' % names , verbose=LOG_LEVEL_DEBUG)
	if ' s' in names and arg in names :
		offset = GetMemberOffset(stack , arg) - GetMemberOffset(stack ,' s')
		if base :
			return GetRegValue(base) + offset
		else:
			return offset
	
	return None