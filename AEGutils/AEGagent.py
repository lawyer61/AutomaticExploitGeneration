#-*- coding:utf-8 -*-

'''
Agents for common commands(e.g. cross-system function call, pwntools function)

'''

import subprocess
from AEGcommon import printf
from AEGconfig import LOG_LEVEL_DEBUG
from AEGinfo import *

def pwntools_agent(cmd):
	
	cmd = cmd.replace('"' , '\\"')
	cmd = 'python -c "from pwn import *;%s"' % cmd
	if INFO_SYSTEM == 'windows':
		cmd = 'wsl -- ' + cmd
	printf("PWNTOOLS AGENT got cmd:%s" % cmd , verbose=LOG_LEVEL_DEBUG)
	proc = subprocess.Popen(cmd , stderr=subprocess.PIPE , stdout = subprocess.PIPE,shell = True)
	out = proc.communicate()[0]
	printf(out , verbose=LOG_LEVEL_DEBUG)
	return out.strip('\n')

def ROPGadget_agent(filename = INFO_INPUT_FILENAME , addition_cmd = ''):
	cmd = "ROPgadget --binary=%s %s" % (filename , addition_cmd)
	if INFO_SYSTEM == 'windows':
		cmd = "wsl -- " + cmd 
	#cmd = cmd.replace('"' , '\\"')
	proc = subprocess.Popen(cmd , stderr=subprocess.PIPE , stdout=subprocess.PIPE , shell=True)
	out = proc.communicate()[0]
	return out.split("\n")[2:]
	return None
